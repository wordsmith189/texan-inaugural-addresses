---
title: "6 Sentiment"
description: |
  A sentiment analysis of the speeches.
author:
  - name: Lars Hinrichs
    url: https://larshinrichs.site
    affiliation: The University of Texas at Austin
    affiliation_url: https://liberalarts.utexas.edu/english
date: 12-21-2020
output:
  distill::distill_article:
    self_contained: false
    toc: true
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      cache = TRUE,
                      cache.lazy = FALSE)
library(pacman)

p_load(rio, dplyr, ggplot2, stringr, knitr, 
       kableExtra, beepr, tidytext)

corpus <- import("data/corpus_postagged.RDS")
```

## Overall sentiment

In sentiment analysis, each word is scored for its emotional base value. Some words have a positive core, other negative. A little under 10% of all words in these speeches are recognized as conveying (positive or negative) sentiment.

### Global scores per speech

The first plot gives a comparison of pos. and neg. scores for each inaugural.

```{r viz-sentiment}
n_total <- 
  corpus %>% 
  count(doc_id) %>% 
  rename(total = n)

corpus_sent <- 
  corpus %>% 
  mutate(word = tolower(token)) %>% 
  anti_join(stop_words) %>% 
  left_join(get_sentiments("bing"))

n_sent <- 
  corpus_sent %>% 
  count(doc_id, sentiment) %>% 
  na.omit() %>% 
  left_join(n_total) %>% 
  mutate(sent_norm = n/total*1000)

pal <- wesanderson::wes_palette("Cavalcanti1", 2, type = "discrete")

n_sent %>% 
  mutate(sentiment = factor(sentiment, levels = c("positive", "negative"))) %>% 
  ggplot(aes(doc_id, sent_norm, 
             group = sentiment, 
             fill = sentiment)) +
  geom_col() +
  scale_fill_manual(values = pal) +
  labs(
    title = "Emotionally Loaded Words in Texan Inaugurals",
    subtitle = "Frequencies per 1,000 words",
    x = NULL, y = NULL,
    caption = "www.texasenglish.org"
  ) +
  theme_bw(base_family = "Volkhov-Regular",
           base_size = 10) +
  theme(#legend.title       = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        plot.title.position = "plot",
        plot.caption = element_text(hjust = 0),
        plot.caption.position =  "plot")
```

### Top  Positive Terms

The following plot shows the most frequent positive-scored terms for each speech together with its number of occurrences.

```{r top-pos-terms, layout="l-body-outset", fig.cap="Sentiment analysis: top-ranked positive terms.", fig.height=6}
terms_pos <- 
  corpus_sent %>% 
  filter(sentiment == "positive") %>% 
  mutate(lemma = tolower(lemma)) %>% 
  group_by(doc_id, lemma) %>% 
  summarise(mentions = n()) %>% 
  left_join(n_total) %>% 
  mutate(freq = mentions/total*1000) %>% 
  ungroup() 

terms_pos <- 
  terms_pos %>% 
  group_by(doc_id) %>% 
  top_n(6) %>% 
  ungroup() %>% 
  arrange(doc_id, freq) %>%
  mutate(order = row_number())

pal <- wesanderson::wes_palette("Darjeeling2", 4, type = "discrete")

terms_pos %>% 
  ggplot(aes(order, freq, fill=doc_id)) +
  geom_col(show.legend = F) +
  scale_fill_manual(values = pal) +
  labs(title = "Most Frequent Positive Sentiment Words in Texan Inaugurals",
       subtitle = "Frequencies per 1,000 words",
       x = NULL, y = NULL, caption = "www.texasenglish.org") +
  scale_x_continuous(
    breaks = terms_pos$order,
    labels = terms_pos$lemma,
    expand = c(0,0)
  ) +
  facet_wrap(~doc_id,
             scales = "free") +
  theme_bw(base_family = "Volkhov-Regular",
           base_size = 10) +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        plot.title.position = "plot",
        plot.caption = element_text(hjust = 0),
        plot.caption.position =  "plot"
        ) +
  coord_flip()

```

<aside>

Shown are the top-6 ranked terms for each speech. Sometimes there are ties for ranks.

</aside>

### Top Negative Terms

Below follows the same visualization as above, but for the terms with negative semantic loads.

```{r top-neg-terms, layout="l-body-outset", fig.cap="Sentiment analysis: top-ranked negative terms.", fig.height=6}
terms_neg <- 
  corpus_sent %>% 
  filter(sentiment == "negative") %>% 
  mutate(lemma = tolower(lemma)) %>% 
  group_by(doc_id, lemma) %>% 
  summarise(mentions = n()) %>% 
  left_join(n_total) %>% 
  mutate(freq = mentions/total*1000) %>% 
  ungroup() 

terms_neg <- 
  terms_neg %>% 
  group_by(doc_id) %>% 
  mutate(linenumber = row_number()) %>% 
  ungroup() %>% 
  filter(linenumber < 7) %>% 
  arrange(doc_id, mentions) %>%
  mutate(order = row_number())

terms_neg %>% 
  ggplot(aes(order, freq, fill=doc_id)) +
  geom_col(show.legend = F) +
  scale_fill_manual(values = pal) +
  labs(title = "Most Frequent Negative Sentiment Words in Texan Inaugurals",
       subtitle = "Frequencies per 1,000 words",
       x = NULL, y = NULL, 
       caption = "www.texasenglish.org") +
  facet_wrap(~doc_id,
             scales = "free") +
  theme_bw(base_family = "Volkhov-Regular",
           base_size = 10) +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        plot.title.position = "plot",
        plot.caption = element_text(hjust = 0),
        plot.caption.position =  "plot"
        ) +
    scale_x_continuous(
      breaks = terms_neg$order,
      labels = terms_neg$lemma,
      expand = c(0,0)
  ) +
  coord_flip()

```
